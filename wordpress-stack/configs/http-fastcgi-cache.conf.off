#nginx fastcgi cache configuration

# path
fastcgi_cache_path /tmp/nginx_cache levels=1:2 keys_zone=nginx_cache:10m max_size=1g inactive=24h use_temp_path=off;

#map to configure cacheable content
map $request_uri $bypass_nginx_cache {
    # ~.*/poll/.*       0;
    default         1;
}

# cache settings
fastcgi_cache                   nginx_cache;
fastcgi_cache_background_update on;
#fastcgi_cache_bypass            $bypass_nginx_cache;
fastcgi_no_cache                $bypass_nginx_cache;
fastcgi_cache_key               $request_uri;
fastcgi_cache_lock              off;
fastcgi_cache_lock_age          5s;
fastcgi_cache_lock_timeout      5s;
fastcgi_cache_methods           GET HEAD POST;
fastcgi_cache_min_uses          1;
fastcgi_cache_revalidate        off;
fastcgi_cache_use_stale error   timeout updating http_500 http_503;
fastcgi_cache_valid 200         30s;
#fastcgi_cache_valid 404         1m;
#fastcgi_cache_valid 403         1h;
fastcgi_ignore_headers Cache-Control Expires;

#
add_header X-FastCGI-Cache $upstream_cache_status;